// -------------------- // 
// NAMING SCHEME 
//  - Models      are PASCAL CASE           like datatypes i.e. DateTime
//  - Fields      are regular CAMEL CASE    i.e. firstName
//  - Relations   are SNAKE CASE            i.e. @relation("teacher_in_charge") [inconsistent remove maybe?]
//  - Enumerations are ALL CAPS             i.e. enum Role { ADMIN, TEACHER, STUDENT }
//  - Table Names are PLURAL                i.e. Students
//  - Column Names are SINGULAR             i.e. firstName
// -------------------- // 

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"] // https://www.prisma.io/docs/concepts/components/prisma-client/full-text-search
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// -------------------- // 
// USER ACCOUNTS //
// -------------------- //
enum Role {
  STUDENT
  TEACHER
  ADMIN
}

model SchoolYear {
  id                String   @id @default(uuid())
  yearStart         Int
  yearEnd           Int
  createdAt         DateTime @default(now())
  currentSchoolYear Boolean  @default(false)
  campus            String   @default("EASTERN VISAYAS CAMPUS")

  materialEquipmentRequestControlNumberCounter Int @default(0)
  equipmentRequestControlNumberCounter         Int @default(0)
  reagentRequestControlNumberCounter           Int @default(0)
  laboratoryRequestControlNumberCounter        Int @default(0)

  materialsAdded InventoryOfMaterials[]
  equipmentAdded InventoryOfEqupiment[]
  reagentsAdded  InventoryOfReagents[]

  laboratoryRequests LaboratoryRequests[]
  EquipmentRequests  EquipmentRequests[]
  MaterialRequests   MaterialRequests[]
  ReagentRequests    ReagentRequests[]
}

model Users {
  id        String  @id @default(uuid())
  email     String
  firstName String
  lastName  String
  role      Role    @default(STUDENT)
  imageLink String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studentProfile Students? @relation(fields: [studentsId], references: [id])
  teacherProfile Teachers? @relation(fields: [teachersId], references: [id])
  adminProfile   Admins?   @relation(fields: [adminsId], references: [id])
  studentsId     String?
  teachersId     String?
  adminsId       String?

  requests LaboratoryRequests[]

  changeRoleRequest ChangeRoleRequests[]
}

model Admins {
  id             String               @id @default(uuid())
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  signature      String?              @db.MediumText
  signedRequests LaboratoryRequests[]
  userProfile    Users[]
}

model Teachers {
  id                         String               @id @default(uuid())
  createdAt                  DateTime             @default(now())
  updatedAt                  DateTime             @updatedAt
  signature                  String?              @db.MediumText
  receivedLaboratoryRequests LaboratoryRequests[] @relation("teacher_in_charge") //TODO rearrange this when i get to requests
  signedLaboratoryRequests   LaboratoryRequests[] @relation("signed_teacher")
  userProfile                Users[]
}

model Students {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  gradeSection   GradeSection? @relation(fields: [gradeSectionId], references: [id])
  gradeSectionId String?

  grade   Int?
  section String?

  userProfile Users[]
}

model ChangeRoleRequests {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   Users  @relation(fields: [userId], references: [id])
  userId String

  wantedRole Role
}

model GradeSection {
  id                 String               @id @default(uuid())
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  grade              Int
  section            String
  students           Students[]
  laboratoryRequests LaboratoryRequests[]
}

model Units {
  id                 String               @id @default(uuid())
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  name               String
  frequencyRank      Int                  @unique @default(autoincrement())
  laboratoryRequests LaboratoryRequests[]
}

// -------------------- //
// LABORATORIES //
// -------------------- //
model Laboratories {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String
  description String?

  location   LaboratoryLocations @relation(fields: [locationId], references: [id])
  locationId String

  supplies               InventoryOfMaterials[]
  equipment              InventoryOfEqupiment[]
  reagents               InventoryOfReagents[]
  laboratoryReservations LaboratoryReservations[]
}

model LaboratoryLocations {
  id                           String                @id @default(uuid())
  createdAt                    DateTime              @default(now())
  updatedAt                    DateTime              @updatedAt
  name                         String
  description                  String?
  laboratories                 Laboratories[]
  inventoryOfMaterials         InventoryOfMaterials? @relation(fields: [inventoryOfMaterialsSupplyId], references: [id])
  inventoryOfMaterialsSupplyId String?
  inventoryOfEqupiment         InventoryOfEqupiment? @relation(fields: [equipmentId], references: [id])
  equipmentId                  String?
  inventoryOfReagents          InventoryOfReagents?  @relation(fields: [reagentId], references: [id])
  reagentId                    String?
}

model LaboratoryReservations {
  id                 String       @id @default(uuid())
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  controlNumber      String
  laboratoryReserved Laboratories @relation(fields: [laboratoryId], references: [id])
  laboratoryId       String
  startTime          String // Strings but stored in the DateTime format
  endTime            String // Strings but stored in the DateTime format

  laboratoryRequest   LaboratoryRequests @relation(fields: [laboratoryRequestId], references: [id])
  laboratoryRequestId String
}

// -------------------- //
// INVENTORY //
// -------------------- //
model InventoryOfMaterials {
  //Materials refer to small devices for experiments (such as breakers and test tubes) and supplies of the Laboratory Unit (Cleaning Supplies etc..)
  id                 String                @id @default(uuid())
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  itemName           String
  description        String
  additionalPurchase Int?
  make               String?
  supplier           String?
  dateReceived       DateTime?
  quantity           Int                   @default(0)
  unit               String //Unit of measurement like "mL", "mg", etc..
  unitCost           Float?
  borrowed           Int                   @default(0)
  returned           Int                   @default(0)
  damage             Int                   @default(0)
  balancePerCard     Int?
  balancePerCount    Int?
  location           LaboratoryLocations[]
  laboratories       Laboratories?         @relation(fields: [laboratoriesId], references: [id])
  laboratoriesId     String?

  requests     MaterialRequests[]
  available    Boolean            @default(true)
  schoolYear   SchoolYear?        @relation(fields: [schoolYearId], references: [id])
  schoolYearId String?
}

model InventoryOfEqupiment {
  //Equipment refer to the large devices that may not be easily moved from one location to another
  id                    String                @id @default(uuid())
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  equipmentCodeNumber   Int                   @unique @default(autoincrement()) // This is so we can have LE-1, LE-2, etc..
  equipmentCode         String?
  equipmentName         String
  serialNumber          String?
  modelNoOrManufacturer String?
  description           String?
  quantity              Int? // TODO: Double check if this matters as according to the table it will always be 1
  unit                  String?
  unitCost              Float?
  dateReceived          DateTime              @default(now()) // TODO: Change this
  propertyNumber        String?
  acquisitionType       String?
  supplier              String?
  location              LaboratoryLocations[]
  status                String?
  laboratories          Laboratories?         @relation(fields: [laboratoriesId], references: [id])
  laboratoriesId        String?

  requests     EquipmentRequests[]
  available    Boolean             @default(true)
  schoolYear   SchoolYear?         @relation(fields: [schoolYearId], references: [id])
  schoolYearId String?
}

model InventoryOfReagents {
  //Reagents refer to all the chemicals (solid or liquid) Students can request for

  // Identification
  id               String   @id @default(uuid())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  itemNumber       String? // All chemicals with the same chemical name will have the same starting number arranged in alphabetical order then a letter for variant
  casNumber        String?
  chemicalName     String // Same name chemicals should be grouped together
  description      String? // If chemicals are the same name but have a varation (ex: acetic acid - glacial an food grade) or are in differnet bottles(?)
  manufacturerName String?
  supplier         String?

  // Quantities
  currentQuantity Float?
  maxQuantity     Float? // Assuming this means the max quantity someone can request for
  unit            String? // Unit of measurement like "mL", "mg", etc..

  DGClass        String?
  subRisk        String?
  PG             String?
  riskPhrase     String?
  safetyPhrase   String?
  hazSub         Boolean?
  poisonSchedule String?
  currentSDS     DateTime?
  dateReceived   DateTime?
  expiryDate     DateTime?
  dateOpened     DateTime?
  status         String?
  location       LaboratoryLocations[]
  laboratories   Laboratories?         @relation(fields: [laboratoriesId], references: [id])
  laboratoriesId String?

  requests     ReagentRequests[]
  available    Boolean           @default(true)
  schoolYear   SchoolYear?       @relation(fields: [schoolYearId], references: [id])
  schoolYearId String?
}

// -------------------- //
// REQUESTS AND RESERVATIONS //
// -------------------- //
model EquipmentRequests {
  id                    String                 @id @default(uuid())
  controlNumber         String
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  quantity              Int
  equipment             InventoryOfEqupiment[]
  name                  String
  description           String?
  modelNoOrManufacturer String?
  laboratoryRequests    LaboratoryRequests     @relation(fields: [laboratoryRequestsId], references: [id])
  laboratoryRequestsId  String
  schoolYear            SchoolYear?            @relation(fields: [schoolYearId], references: [id])
  schoolYearId          String?
}

model MaterialRequests {
  // TODO: Ask about how the materials work
  id                  String                 @id @default(uuid())
  controlNumber       String
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  quantity            Int
  materials           InventoryOfMaterials[]
  name                String
  description         String?
  laboratoryRequest   LaboratoryRequests     @relation(fields: [laboratoryRequestId], references: [id])
  laboratoryRequestId String
  schoolYear          SchoolYear?            @relation(fields: [schoolYearId], references: [id])
  schoolYearId        String?
}

model ReagentRequests {
  id                   String                @id @default(uuid())
  controlNumber        String
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  quantity             Int
  unit                 String
  reagents             InventoryOfReagents[]
  name                 String
  description          String?
  LaboratoryRequests   LaboratoryRequests    @relation(fields: [laboratoryRequestsId], references: [id])
  laboratoryRequestsId String
  schoolYear           SchoolYear?           @relation(fields: [schoolYearId], references: [id])
  schoolYearId         String?
}

model LaboratoryRequests {
  id                String   @id @default(uuid())
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  requestor         Users    @relation(fields: [requestorId], references: [id])
  requestorId       String
  forSubject        String?
  concurrentTopic   String?
  noOfStudents      Int?
  otherGroupMembers Json?

  gradeSection   GradeSection @relation(fields: [gradeSectionId], references: [id])
  gradeSectionId String

  unit   Units  @relation(fields: [unitId], references: [id])
  unitId String

  teacherInCharge   Teachers @relation("teacher_in_charge", fields: [teacherInChargeId], references: [id])
  teacherInChargeId String

  // TODO: Clarify the materials requested an sample inventory
  materialsRequested     MaterialRequests[]
  equipmentRequested     EquipmentRequests[]
  reagentsRequested      ReagentRequests[]
  laboratoryReservations LaboratoryReservations[]

  isSignedByTeacher Boolean   @default(false)
  isSignedByAdmin   Boolean   @default(false)
  signedTeacher     Teachers? @relation("signed_teacher", fields: [signedTeacherId], references: [id])
  signedTeacherId   String?
  signedAdmin       Admins?   @relation(fields: [signedAdminId], references: [id])
  signedAdminId     String?

  schoolYear   SchoolYear? @relation(fields: [schoolYearId], references: [id])
  schoolYearId String?
}
